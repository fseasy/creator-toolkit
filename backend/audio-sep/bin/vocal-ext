#!/bin/bash


if [ $# -lt 2 ]; then
    echo "用法: $0 <输入文件路径> <输出文件目录> [输出文件格式，默认:wav]"
    exit 1
fi

input_file="$1"
output_dir="${2%/}/vocals_out"
output_format="${3:-wav}"  # 第三个参数可选，默认为 wav

echo "输入文件: $input_file"
echo "输出目录: $output_dir"
echo "输出格式: $output_format"

mkdir -p "$output_dir"

source ~/env/py312/bin/activate

echo "PROXY"

HTTP_PROXY="http://127.0.0.1:20171"
export http_proxy=${HTTP_PROXY} https_proxy=${HTTP_PROXY} all_proxy=${HTTP_PROXY}

MODEL="vocals_mel_band_roformer.ckpt"

echo "RUN"
AUDIO_SEPARATOR_MODEL_DIR=$HOME/bin/audio-sep/models \
audio-separator $input_file -m $MODEL --output_format $output_format --output_dir $output_dir \
  --single_stem Vocals